name: Error Spy Agent ðŸ•µï¸â€â™‚ï¸

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:
  hunt-errors:
    name: ðŸ” Hunting for Real Errors
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Clone Repository
        uses: actions/checkout@v4

      - name: â˜• Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ðŸ˜ Setup Gradle
        uses: gradle/actions/setup-gradle@v4
        with:
          gradle-version: "8.2"

      - name: ðŸ•µï¸â€â™‚ï¸ Run Silent Build & Capture Everything
        run: |
          echo "Spy Agent is running the build in stealth mode..."
          gradle assembleDebug --stacktrace > full_build_log.txt 2>&1 || echo "Build stopped. Time to scan logs!"

      - name: ðŸš¨ Extract Real Errors (The Magic)
        run: |
          echo "### ðŸ•µï¸â€â™‚ï¸ Spy Agent Error Report" >> $GITHUB_STEP_SUMMARY
          echo "à¤®à¥à¤à¥‡ à¤¤à¥à¤®à¥à¤¹à¤¾à¤°à¥‡ à¤•à¥‹à¤¡ à¤®à¥‡à¤‚ à¤¯à¥‡ à¤…à¤¸à¤²à¥€ à¤®à¥à¤œà¤°à¤¿à¤® à¤®à¤¿à¤²à¥‡ à¤¹à¥ˆà¤‚:" >> $GITHUB_STEP_SUMMARY
          echo '```text' >> $GITHUB_STEP_SUMMARY
          
          # Kotlin Syntax Errors
          grep -E "^e: " full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          # AAPT / Resource Errors
          grep -A 3 -i "AAPT: error:" full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          # Main Task Failure
          grep -E "Execution failed for task" full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          echo '```' >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“¤ Upload Full Log (Backup)
        uses: actions/upload-artifact@v4
        with:
          name: Spy-Complete-Log
          path: full_build_log.txt
