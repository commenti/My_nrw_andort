name: Error Spy Agent ðŸ•µï¸â€â™‚ï¸

on:
  workflow_dispatch: # à¤¯à¤¹ à¤¤à¥à¤®à¥à¤¹à¥‡à¤‚ GitHub à¤¸à¥‡ à¤à¤• à¤¬à¤Ÿà¤¨ à¤¦à¤¬à¤¾à¤•à¤° à¤‡à¤¸à¥‡ à¤°à¤¨ à¤•à¤°à¤¨à¥‡ à¤•à¥€ à¤¤à¤¾à¤•à¤¤ à¤¦à¥‡à¤—à¤¾
  push:
    branches: [ "main" ]

jobs:
  hunt-errors:
    name: ðŸ” Hunting for Real Errors
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Clone Repository
        uses: actions/checkout@v3

      - name: â˜• Setup Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ðŸ”¨ Grant Execute Permission to Gradle
        run: chmod +x ./gradlew

      - name: ðŸ•µï¸â€â™‚ï¸ Run Silent Build & Capture Everything
        # à¤¹à¤® à¤œà¤¾à¤¨à¤¬à¥‚à¤à¤•à¤° à¤¬à¤¿à¤²à¥à¤¡ à¤«à¥‡à¤² à¤¹à¥‹à¤¨à¥‡ à¤ªà¤° à¤­à¥€ à¤¸à¥à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿ à¤•à¥‹ à¤°à¥à¤•à¤¨à¥‡ à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡à¤‚à¤—à¥‡ (|| true) 
        # à¤¤à¤¾à¤•à¤¿ à¤¹à¤® à¤²à¥‰à¤—à¥à¤¸ à¤•à¥‹ à¤¸à¥à¤•à¥ˆà¤¨ à¤•à¤° à¤¸à¤•à¥‡à¤‚à¥¤
        run: |
          echo "Spy Agent is running the build in stealth mode..."
          ./gradlew assembleDebug --stacktrace > full_build_log.txt 2>&1 || echo "Build stopped. Time to scan logs!"

      - name: ðŸš¨ Extract Real Errors (The Magic)
        # à¤¯à¤¹ à¤¸à¥à¤Ÿà¥‡à¤ª 10,000 à¤²à¤¾à¤‡à¤¨à¥‹à¤‚ à¤®à¥‡à¤‚ à¤¸à¥‡ à¤¸à¤¿à¤°à¥à¤« à¤…à¤¸à¤²à¥€ à¤à¤°à¤° à¤›à¤¾à¤à¤Ÿ à¤•à¤° à¤¨à¤¿à¤•à¤¾à¤²à¥‡à¤—à¤¾
        run: |
          echo "### ðŸ•µï¸â€â™‚ï¸ Spy Agent Error Report" >> $GITHUB_STEP_SUMMARY
          echo "à¤®à¥à¤à¥‡ à¤¤à¥à¤®à¥à¤¹à¤¾à¤°à¥‡ à¤•à¥‹à¤¡ à¤®à¥‡à¤‚ à¤¯à¥‡ à¤…à¤¸à¤²à¥€ à¤®à¥à¤œà¤°à¤¿à¤® à¤®à¤¿à¤²à¥‡ à¤¹à¥ˆà¤‚:" >> $GITHUB_STEP_SUMMARY
          echo '```text' >> $GITHUB_STEP_SUMMARY
          
          # 1. Kotlin Syntax Errors (e: à¤µà¤¾à¤²à¥€ à¤²à¤¾à¤‡à¤¨à¥‡à¤‚) à¤ªà¤•à¤¡à¤¼à¥‹
          grep -E "^e: " full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          # 2. AAPT / Resource Errors (XML, Mipmap) à¤ªà¤•à¤¡à¤¼à¥‹
          grep -A 3 -i "AAPT: error:" full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          # 3. Main Task Failure (à¤•à¤¿à¤¸ à¤µà¤œà¤¹ à¤¸à¥‡ à¤¬à¤¿à¤²à¥à¤¡ à¤°à¥à¤•à¤¾) à¤ªà¤•à¤¡à¤¼à¥‹
          grep -E "Execution failed for task" full_build_log.txt >> $GITHUB_STEP_SUMMARY || true
          
          echo '```' >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“¤ Upload Full Log (Backup)
        uses: actions/upload-artifact@v3
        with:
          name: Spy-Complete-Log
          path: full_build_log.txt
